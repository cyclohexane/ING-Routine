# 01

### 这几天用ionic-native插件做文件上传的步骤：

1. Chooser 获得文件原始数据（uint8array类型） ，用原生 FormData 来 append()（blob/string类型），数据类型不对所以弃了。看到了也许可以用 File 插件根据uri找到原文件后手动转换，但是感觉有点绕弯。//之后发现可以用以下方式转换：

```js
var blob = new Blob([new Uint8Array(this.result)], { type: "image/png" });
```

//而且原生 XMLHttpRequest 可以传输 blob。
//见[Transition off of cordova-plugin-file-transfer](https://cordova.apache.org/blog/2017/10/18/from-filetransfer-to-xhr2.html)

1. Chooser 获得文件路径（uri），用 FileTransfer 来上传。Chooser.getFile() 的参数是可选的但是TS非要我传一个参数，我试着传了`'*'`，结果没有匹配的文件，换了`'image/*'`，选择文件后就毫无反应，既不进入then也不进入catch，不提示任何信息，弃了。

1. Camera 拍摄和裁剪图片，获得图片路径，用 FileTransfer 来上传，成功，但是 Camera 的图片质量只能选择20左右(上传后是200kb左右)，到了90就会裁剪失败（闪退）、上传失败（Request Entity Too Large）。

1. FileChooser 获得文件路径（uri），用FileTransfer来上传。选了个1mb的图片，上传失败（Request Entity Too Large）。

1. 发现是后台设置了接收文件上限。遂沟通。并调高 Camera 的图片质量到40。

1. FileTransfer 下载文件。保存路径为官方给的例子中的this.file.dataDirectory。但是相册中好像显示不出下载的图片。

1. 想参考[ionic3 文件上传下载和预览](https://segmentfault.com/a/1190000010978562)，在下载文件后直接用fileOpener打开，但是考虑到mime类型不是很完善，而且用户可能需要多次手动打开，所以
